#!/bin/bash

GOJSON=../../../../../tools/bin/gojson

DIST_DIR=../dist
OUT_DIR=../../

FILE_NAMES=("service_types" "integration_types" "integration_endpoint_types")
STRUCT_NAMES=("ServiceTypes" "IntegrationTypes" "IntegrationEndpointTypes")

for i in "${!FILE_NAMES[@]}"; do
    FILE_NAME=${FILE_NAMES[$i]}
    STRUCT_NAME=${STRUCT_NAMES[$i]}

    echo "generating ${FILE_NAME}.go (${STRUCT_NAME})"

    curl -o ${DIST_DIR}/"${FILE_NAME}".yml -s https://raw.githubusercontent.com/aiven/aiven-go-client/master/tools/exp/dist/"${FILE_NAME}".yml
    echo "downloaded ${FILE_NAME}.yml"

    ${GOJSON} -fmt yaml -input ${DIST_DIR}/"${FILE_NAME}".yml -name "${STRUCT_NAME}" -o ${OUT_DIR}/"${FILE_NAME}".go -pkg schema
    echo "converted ${FILE_NAME}.yml to ${FILE_NAME}.go (struct ${STRUCT_NAME})"

    echo -e "// Code generated by gojson. DO NOT EDIT.\n\n$(cat ${OUT_DIR}/"${FILE_NAME}".go)" > ${OUT_DIR}/"${FILE_NAME}".go
    echo "added code generation comment to ${FILE_NAME}.go"

    echo -e "generated ${FILE_NAME}.go (${STRUCT_NAME})\n"
done
